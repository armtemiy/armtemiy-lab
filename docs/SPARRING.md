# Модуль "Поиск спарринг-партнёров"

Этот модуль позволяет армрестлерам находить друг друга на карте для совместных тренировок.

## Функционал

1.  **Интерактивная карта (Leaflet):**
    *   Отображение всех активных спарринг-партнёров.
    *   Кластеризация меток (группировка при отдалении).
    *   Цветовое кодирование по стилям борьбы (Верх/Крюк/Универсал).
    *   Фильтрация по радиусу (показывает ближайших к пользователю).

2.  **Профиль пользователя:**
    *   Создание/Редактирование профиля.
    *   **Фото:** Загрузка из Telegram (автоматически) или загрузка своего фото из галереи устройства.
    *   **Геолокация:** Автоматическое определение по GPS или ручной выбор (поиск по адресу).
    *   **Данные:** Вес (кг/lbs), стаж, рабочая рука, стиль борьбы, краткое описание "О себе".

3.  **Взаимодействие:**
    *   Просмотр чужих профилей.
    *   Кнопка "Написать в Telegram" (открывает личный чат).

## Техническая реализация

### База данных (Supabase)

Таблица `sparring_profiles`:
*   `id` (uuid): Primary Key.
*   `telegram_user_id` (text, unique): ID пользователя в Telegram.
*   `latitude`, `longitude` (float): Координаты.
*   `is_active` (boolean): Видимость на карте.
*   ...остальные поля анкеты.

Хранилище `storage.buckets.avatars`:
*   Хранит загруженные пользователями фото.
*   Политики RLS (Row Level Security) настроены на публичное чтение и запись только авторизованным пользователям (через анонимный ключ с проверкой заголовков или логики приложения).

### Frontend (React)

*   `SparringMap.tsx`: Компонент карты с ленивой загрузкой Leaflet.
*   `SparringProfilePage.tsx`: Страница просмотра чужого профиля.
*   `SparringMyProfilePage.tsx`: Страница редактирования своего профиля.
*   `lib/sparring.ts`: API методы для работы с Supabase и Geocoding.

### Бот (Python/Aiogram)

*   Отображает краткую информацию о спарринг-профиле в команде `/profile`.
*   Предоставляет кнопку "Админка" (для админов) со статистикой по пользователям.

## Развертывание

1.  Применить миграции из `supabase/migrations/`.
2.  Настроить переменные окружения `VITE_SUPABASE_URL` и `VITE_SUPABASE_ANON_KEY`.
3.  Собрать проект `npm run build`.
