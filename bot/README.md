# Armtemiy Lab Bot

Телеграм-бот для проекта Armtemiy Lab. Помогает анализировать армрестлинг поединки и предоставляет доступ к мини-приложению.

## Структура проекта

Проект имеет модульную архитектуру:

- **db/** — Работа с базой данных (SQLAlchemy, AsyncPG).
  - `models.py` — Модели таблиц (User, RateLimitEntry).
  - `database.py` — Настройка подключения (Async Engine).
- **handlers/** — Обработчики сообщений.
  - `start.py` — Команда /start, проверка подписки, регистрация.
  - `menu.py` — Главное меню (Профиль, Инфо).
  - `admin.py` — Админ-панель.
- **keyboards/** — Клавиатуры.
  - `reply.py` — Главное меню (кнопки внизу).
  - `inline.py` — Кнопки под сообщениями (подписка).
- **middlewares/** — Промежуточное ПО.
  - `spam_protection.py` — Защита от спама (Rate Limit) с использованием БД.
- **services/** — Бизнес-логика.
  - `subscription.py` — Проверка подписки на канал.
  - `user_service.py` — Создание/получение пользователя.
- **utils/** — Утилиты.
- **config.py** — Конфигурация и переменные окружения.
- **main.py** — Точка входа.

## Установка и запуск

1. **Требования**:
   - Python 3.10+
   - PostgreSQL (Supabase)

2. **Установка зависимостей**:
   ```bash
   pip install -r requirements.txt
   ```

3. **Настройка окружения (.env)**:
   Создайте файл `.env` в корне (или используйте системные переменные):
   ```
   BOT_TOKEN=ваш_токен
   DATABASE_URL=postgresql+asyncpg://user:pass@host:5432/db
   CHANNEL_ID=@ваш_канал
   CHANNEL_URL=https://t.me/ваш_канал
   ADMIN_ID=123456789
   WEBAPP_URL=https://ваш_url_приложения
   ```

   **Важно для Supabase**: Используйте Session Pooler (порт 5432) и драйвер `postgresql+asyncpg`.

4. **Запуск**:
   ```bash
   python main.py
   ```

## Функционал

- **Обязательная подписка**: Бот не пускает дальше `/start`, если пользователь не подписан на канал.
- **Профиль**: Отображение ID, даты регистрации.
- **Анти-спам**: Ограничение количества запросов (30 запросов в минуту), состояние хранится в БД.
- **Админка**: Отдельная кнопка в меню (только для админа), показывает статистику пользователей.
